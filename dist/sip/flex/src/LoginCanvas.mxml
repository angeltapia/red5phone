<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="256" height="228" backgroundColor="#3E413E" borderStyle="solid" 
    cornerRadius="0" backgroundAlpha="0.0" creationComplete="init()">
	<mx:Style>
		Button {
		   color: white;
		   fill-colors: #ff0000, #dd0000;
		}
	</mx:Style>
	
	<mx:Script>
		<![CDATA[

			private var so:SharedObject;
			
			private function init():void {
				so = SharedObject.getLocal("Red5Phone");				
			}
			
			public function setParameters(realm:String, server:String, red5url:String, username:String, password:String, mailbox:String, autologin:Boolean):void {
			

				if (realm == null || realm == "") {

					if(so.data.realm){
						realmTxt.text = so.data.realm;
					} else {
						realmTxt.text = "asterisk";
					}
				} else realmTxt.text = realm;
				

				if (server == null || server == "") {

					if(so.data.server){
						serverTxt.text = so.data.server;
					} else {
						serverTxt.text = "";
					}
				} else serverTxt.text = server;
				


				if (red5url == null || red5url == "") {

					if(so.data.red5url){
						urlTxt.text = so.data.red5url;
					} else {
						urlTxt.text = "rtmp:/sip";
					}
				} else urlTxt.text = red5url;


				if (username == null || username == "") {

					if(so.data.username){
						usernameTxt.text = so.data.username;
					} else {
						usernameTxt.text = "";
					}
				} else usernameTxt.text = username;
				

				if (password == null || password == "") {

					if(so.data.password){
						passwordTxt.text = so.data.password;
					} else {
						passwordTxt.text = "";
					}
				} else passwordTxt.text = password;
				

				if (mailbox == null || mailbox == "") {

					if(so.data.mailbox){
						mailboxTxt.text = so.data.mailbox;
					} else {
						mailboxTxt.text = "";
					}
				} else mailboxTxt.text = mailbox;
				

				
				if (autologin && serverTxt.text != "" && usernameTxt.text != "" && passwordTxt.text != "") {
					this.parentApplication.login(usernameTxt.text, passwordTxt.text, realmTxt.text, serverTxt.text, urlTxt.text, mailboxTxt.text);
				}
				
			}
			
			private function login():void {
				this.parentApplication.login(usernameTxt.text, passwordTxt.text, realmTxt.text, serverTxt.text, urlTxt.text, mailboxTxt.text);
				
				so.data.username   = usernameTxt.text;
				so.data.password   = passwordTxt.text;
				so.data.red5url    = urlTxt.text;
				so.data.siprealm   = realmTxt.text;
				so.data.sipserver  = serverTxt.text;
				so.data.mailbox    = mailboxTxt.text;
				so.flush();				
			}
			
			public function setMessage(message:String):void {
				alertMessage.text = message;
			}
		]]>
	</mx:Script>
	
	<mx:Text x="10" y="10" text="Username" width="85" height="20" fontSize="13" color="#E98F02" fontWeight="bold"/>
	<mx:TextInput x="107" y="11" width="137" id="usernameTxt"/>
	<mx:Text x="10" y="35" text="Password" width="85" height="20" fontSize="13" color="#E98F02" fontWeight="bold"/>
	<mx:TextInput x="107" y="36" width="137" displayAsPassword="true" id="passwordTxt"/>
	<mx:Text x="10" y="60" text="MailBox" width="85" height="20" fontSize="13" color="#E98F02" fontWeight="bold"/>
	<mx:TextInput x="107" y="61" width="137" id="mailboxTxt"/>

	<mx:Text x="10" y="85" text="SIP Realm" width="85" height="20" fontSize="13" color="#E98F02" fontWeight="bold"/>
	<mx:TextInput x="107" y="86" width="137" id="realmTxt"/>
	<mx:Text x="10" y="110" text="SIP Server" width="85" height="20" fontSize="13" color="#E98F02" fontWeight="bold"/>
	<mx:TextInput x="107" y="111" width="137" id="serverTxt"/>
	<mx:Text x="10" y="138" text="Red5 URL" width="85" height="20" fontSize="13" color="#E98F02" fontWeight="bold"/>
	<mx:TextInput x="107" y="139" width="137" id="urlTxt"/>
	
	<mx:Button x="188" y="168" label="Login" click="login()" fillAlphas="[1.0, 1.0]" fillColors="[#FF0000, #DD0000]" color="#FFFFFF" themeColor="#DD0000"/>
	<mx:Text x="10" y="187"  color="#FD0202" fontSize="9" id="alertMessage"/>
	
	
</mx:Canvas>
